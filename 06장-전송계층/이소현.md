# 학습 목표

- 전송 계층의 역할을 이해하기
- 연결형 통신과 비연결형 통신을 이해하기
- TCP/UDP 이해하기

# 23 전송 계층의 역할

## 01 전송 계층의 두 가지 역할

### 라우터의 라우팅 기능으로 데이터를 전송하더라도 목적지에 도착하지 못한다면?

- 목적지에 도착하지 못하는 경우
    - 라우팅 정보가 잘못될 수도 있음
    - 많은 라우터를 경유하는 도중에 라우터에 문제가 생기거나 패킷이 손상될 수 있음
- 물리, 데이터링크, 네트워크 계층 3개만 있으면 목적지에 데이터를 보낼 수 있음
    - 그러나 데이터가 손상되거나 유실되더라도 아래 3개 계층에서는 뭘 해줄 수가 없음
    
    → **전송 계층의 필요성**
    
- 전송 계층: 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요
- **즉, 네트워크 계층은 목적지까지 데이터를 전달하고, 전송 계층에서 데이터가 제대로 도착했는지 확인하는 것**

### 전송 계층의 기능

1. 전송 계층에 오류를 점검하는 기능
    - 오류가 발생하면 데이터를 재전송하도록 요청함
2. 전송된 데이터의 **목적지가 어떤 어플리케이션인지** 식별하는 기능
    
    즉, 해당 데이터가 어떤 어플리케이션에서 사용하는 데이터인지 판단함
    
    1. ex) 홈페이지에서 사용하는 데이터를 메일 프로그램에 전송하는 일을 방지

## 02 연결형 통신과 비연결형 통신

- 전송 계층의 특징은 신뢰성/정확성과 효율성으로 구분 가능
    - 신뢰성/정확성: 데이터를 목적지에 문제없이 전달하는 것
    - 효율성: 데이터를 빠르고 효율적으로 전달하는 것
- 연결형 통신
    - 상대편과 확인해 가면서 통신하는 방식
    - 데이터를 교환하기 전에 연결을 맺고 데이터를 교환하는 동안 계속 연결 관리
    - **신뢰성/정확성 우선** → 여러번 확인하고 보냄
    - TCP(transmission control protocol) 사용
- 비연결형 통신
    - 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식
    - **효율성 우선** → 확인 절차 없이 일방적으로 보냄
    - 예시: 동영상을 볼 때 → 동영상은 신뢰/정확한 정보보다 빠른 전송이 필요하기 때문
    - UDP(user datagram protocol) 사용

![image.png](attachment:24355057-7f6a-432f-a9d0-751c1b746875:image.png)

# 24 TCP의 구조

## 01 TCP란?

- TCP: 신뢰성과 정확성을 우선으로 하는 연결형 통신 프로토콜
- TCP 헤더: TCP로 전송할 때 붙이는 헤더
- 세그먼트: TCP 헤더가 붙은 데이터
- TCP 헤더에는 목적지까지 데이터를 전송하기 위해 필요한 정보를 가지고 있음
- 데이터를 전송하기 전에 해야하는 작업 → 연결
- 연결: 가상의 독점 통신로를 확보하는 작업

### 연결은 어떻게 확립하는것?

- TCP 헤더의 코드 비트 부분
- 코드 비트는 TCP 헤더의 107번째~112번째 비트까지 6비트 → 연결의 제어 정보가 기록되는 곳
- 코드 비트는 각 비트별로 역할이 있음
    - 초깃값 0, 비트 활성화 시 1이됨
- 연결을 확립하려면 SYN과 ACK이 필요함
    - SYN: 연결 요청
    - ACK: 확인 응답
- 연결을 종료하려면 FIN과 ACK이 필요함
    - FIN: 연결 종료

## 02 3-way 핸드셰이크란?

- 연결 과정: 데이터를 전송하기 전에 패킷을 교환할 때 세 번 확인함
    1. 연결 확립 요청으로 SYN을 보냄
    2. 연결 확립 응답 + 연결 확립 요청으로 SYN+ACK을 보냄
    3. 연결 확인 응답으로 ACK을 보냄
    - 이 과정에서 코드 비트의 SYN과 ACK이 1로 활성화 되는 것
- 3-way 핸드셰이크: 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것
- 컴퓨터1 → 컴퓨터2 연결 종료 과정: 연결을 끊기 전에 요청을 교환하고 확인 작업을 해야함
    1. 컴퓨터 1이 연결 종료 요청으로 FIN을 보냄
    2. 컴퓨터 2가 연결 종료 응답으로 ACK을 반환
    3. 컴퓨터 2가 연결 종료 요청으로 FIN을 보냄
    4. 컴퓨터 1이 연결 종료 응답 ACK을 반환
    - 이 과정에서 FIN과 ACK가 1로 활성화됨

# 25 일련번호와 확인 응답 번호의 구조

## 01 일련번호와 확인 응답 번호란?

- 3-way 핸드셰이크가 끝나고 실제 데이터를 보내거나 데이터를 받을 때: **TCP 헤더의 일련번호와 확인 응답 번호**를 사용함
- 일련번호: 송신측에서 수신 측에 이 데이터가 몇 번째 데이터인지 알려줌
    - TCP는 데이터를 분할해서 보내기 때문에, 이 일련번호로 데이터 순서를 알 수 있음
- 확인 응답 번호: 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려줌
    - ex) 10번째 데이터를 수신하면 11번째 데이터를 송신 측에 요청함
- **재전송 제어: 데이터가 손상되거나 유실된 경우에 데이터를 재전송하는 것**
    - 데이터 전송 중 오류가 발생하면 일정 시간 대기한 후 재전송하는 것

## 02 윈도우 크기란?

- 앞에서 말한 일련번호와 확인 응답을 사용하는 방식은 한 번 보낼 때 마다 한 번 응답을 반환하는 방식
    - 효율성이 떨어짐
- 매번 확인 응답을 기다리는 대신 세그먼트(=데이터)를 연속해서 보내고, 확인 응답을 반환하면 효율이 높아짐
    - 상대방이 세그먼트를 처리하는 방식은?
        - **버퍼**에 보관
- 버퍼 사용 → 세그먼트를 연속으로 보내도 수신 측에서 대응하고 확인 응답의 효율도 높아짐
- 오버플로: 수신 측은 대량으로 데이터가 전송되면 보관하지 못하고 넘쳐버림
    - **따라서 데이터가 넘치지 않도록 버퍼의 한계 크기를 알고 있어야함**(=원도우 크기)
- 윈도우 크기: 얼마나 많은 용량의 데이터를 저장해둘 수 있는지
    - = 확인 응답을 일일이 하지 않고 연속해서 송수신할 수 있는 데이터 크기

### 윈도우 크기는 언제 알게되나요?

- 3-way 핸드셰이크할 때 같이 전달함

![image.png](attachment:6e7ad64a-fa86-44bc-b87a-f81f6b57205c:image.png)

### 확인 응답을 기다리지 않고 세그먼트를 보내는 것

![image.png](attachment:977cb744-3071-4d30-8c27-ced4c91b1a51:image.png)

- 받았는지 여부를 송신마다 일대일로 응답을 주는거임

# 26 포트 번호의 구조

- 포트가 있어서 전송 계층이 전송된 데이터의 목적지가 어떤 어플리케이션인지 구분하는 역할을 할 수 있는 것
- 목적지가 어떤 어플리케이션인지 구분하지 못하면?
    - 사용자가 웹 브라우저를 사용하는 데도 메일 프로그램으로 데이터 전송이 되는 사고가 발생할 수 있음
- 목적지 어플리케이션을 알기 위해 **TCP 헤더의 출발지 포트 번호, 목적지 포트 번호**가 필요
    - 포트 번호를 사용해서 웹 브라우저인지 메일 프로그램인지 구분하는 것
- 포트번호는 0~65535번 사용 가능
    - **잘 알려진 포트: 0~1023번 포트** → 주요 프로토콜이 사용하도록 예약됨
        - 일반적으로 사용하는 서버 측 어플리케이션에서 사용됨
    - 1024번 포트: 예약되어 있지만 사용되지는 않는 포트
    - 1025번~:랜덤 포트, 클라이언트 측의 송신 포트로 사용됨
- 어플리케이션과 포트 번호
    
    
    | 어플리케이션 | 포트 번호 |
    | --- | --- |
    | SSH | 22 |
    | SMTP | 25 |
    | DNS | 53 |
    | HTTP | 80 |
    | POP3 | 110 |
    | HTTPS | 443 |
- 동작하는 어플리케이션은 포트 번호가 달라서 구분 가능함
    - 즉, TCP가 어떤 어플리케이션이 사용되고 있는지 알기 위해서는 포트 번호가 필요함

### 포트 번호를 붙이지 않고 통신하면?

- 컴퓨터에 데이터가 도착하더라도 어플리케이션까지는 도착할 수 없음 → 통신 불가

- 웹 브라우저에는 임의의 포트가 자동으로 할당됨
    
    → 서버 측에서는 포트 번호를 정해 둬야 하지만, 클라이언트 측은 정하지 않아도됨
    

![image.png](attachment:c19b6acb-8062-46d1-a87c-dda86b4ab07d:image.png)

### TCP 정리

- 3-way 핸드셰이크로 연결 확립
- 데이터를 전송하고 그때 확인 응답을 함
- 데이터 전송 중 오류가 발생하면 재전송
- 포트 번호로 어플리케이션을 구분하여 데이터를 정확하게 전달

# 27 UDP의 구조

## 01 UDP란?

- 비연결형 통신 → 데이터를 전송할 때 TCP처럼 시간이 걸리는 확인 작업을 일일이 하지 않음
- 효율성을 중요시하는 프로토콜
- 장점: 데이터를 효율적으로 빠르게 보내는 것

## 02 UDP 헤더

- UDP 데이터그램: UDP 헤더가 붙은 데이터
- UDP 헤더 정보: 출발지 포트 번호, 목적지 포트 번호, 길이, 체크섬
- 효율성과 빠른 속도 중요시 → 상대방을 확인하지 않고 연속해서 데이터를 보냄
    - 상대방도 받고 받았다는 응답을 이야기하지 않아도됨
- 브로드캐스트: 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있음
    - cf) TCP는? 3-way 핸드셰이크와 같이 데이터를 전송할 때 확인 응답을 하나씩 보내야함 → 불특정 다수에게 보내는 브로드캐스트에는 적합하지 않음
    - UDP가 목적지에 관계없이 랜에서 일괄적으로 보내기 때문에 가능한 것

# 용어정리

- 대역폭(bandwidth): 정해진 시간 동안 전송될 수 있는 데이터의 양(주로 속도를 의미), 대역폭은 제한적
- 브로드캐스트: 네트워크의 모든 컴퓨터와 장비에 같은 패킷을 일괄 전송하는 방식