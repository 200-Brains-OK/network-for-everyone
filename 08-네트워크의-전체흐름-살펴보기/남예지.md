# 8장. 네트워크의 전체 흐름 살펴보기

## 32. 랜 카드에서의 데이터 전달과 처리

### 네트워크의 구성

1. **응용계층**  
   웹 브라우저를 이용해 사이트에 접속하기 위한 요청을 보낸다.  
   HTTP 프로토콜을 사용한 HTTP 메시지를 보낸다.

2. **전송계층**  
   TCP 헤더가 붙는다 (캡슐화) | 세그먼트  
   출발지 포트번호와 목적지 포트번호가 있음.

3. **네트워크 계층**  
   IP 헤더가 붙는다 (캡슐화) | IP 패킷  
   출발지 IP주소와 목적지 IP주소가 있음.

4. **데이터 링크 계층**  
   이더넷 헤더와 트레일러가 붙는다 (캡슐화) | 이더넷 프레임  
   출발지 MAC 주소와 목적지 MAC 주소가 있음.

5. **물리계층**  
   전기 신호로 변환되어 네트워크로 전송된다.  
   랜카드가 전기 신호 변환을 담당한다.

## 스위치와 라우터에서의 데이터 전달과 처리

### 스위치에서의 데이터 전달과 처리

스위치 A는 데이터 링크 계층에서 데이터를 전기 신호로 변환하여 라우터 A로 전송한다.

### 라우터에서의 데이터 전달과 처리

1. 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다.
2. 주소가 같으면 이더넷 헤더와 트레일러를 분리한다 (역캡슐화).
3. 네트워크 계층에 전달 후 본인의 라우팅 테이블과 목적지 IP 주소를 비교한다 (라우팅).
4. 현재 출발지 IP 주소를 라우터 외부 IP 주소(WAN 주소)로 변경한다.
5. 데이터 링크 계층에서 이더넷 헤더와 트레일러를 붙인다 (캡슐화).
6. 물리계층에서 데이터를 전기 신호로 변환한다.
7. 전기 신호로 변환된 데이터를 라우터 B로 전달한다.

라우터 B는 다음과 같은 처리를 한다:

1. 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다.
2. 주소가 같으면 이더넷 헤더와 트레일러를 분리한다 (역캡슐화).
3. 네트워크 계층에서 자신의 라우팅 테이블과 목적지 IP 주소를 비교한다 (라우팅).
4. 현재의 출발지 주소를 라우터 B의 내부 IP 주소(LAN 주소)로 변경한다.
5. 데이터 링크 계층에서 이더넷 헤더와 트레일러를 붙인다 (캡슐화).
6. 물리계층에서 데이터를 전기 신호로 변환하여 네트워크로 전달한다.

### 웹 서버에서의 데이터 전달과 처리

1. 데이터가 전기 신호로 웹 서버에 도착한다.

**데이터 링크 계층**  
이더넷 프레임의 MAC 주소와 자신의 MAC 주소를 비교한다.  
이더넷 헤더와 트레일러를 분리한다 (역캡슐화).

**네트워크 계층**  
목적지 IP 주소와 웹 서버의 IP 주소를 비교한다.  
IP 헤더를 분리한다 (역캡슐화).

**전송 계층**  
목적지 포트번호를 확인하여 애플리케이션을 판단한다.  
TCP 헤더를 분리한다 (역캡슐화).

**응용 계층**  
데이터 도착.
